# ================================
#        INVOICE TYPE (UPDATED)
# ================================
type Invoice {
  id: ID!
  invoiceNumber: String!
  invoicePrefix: String!
  invoiceSequence: Int!
  status: InvoiceStatus!
  issueDate: DateTime!
  dueDate: DateTime!
  notes: String
  subtotal: Float!
  taxRate: Float!
  taxAmount: Float!
  totalAmount: Float!
  currencyCode: String!
  taxLabelSnapshot: String!

  createdAt: DateTime!
  updatedAt: DateTime!
  deletedAt: DateTime

  # Relations
  project: Project!
  items: [InvoiceItem!]!
  payments: [Payment!]!

  # ðŸ§Š IMMUTABLE SNAPSHOTS (required)
  businessSnapshot: JSON!
  clientSnapshot: JSON!
}

# ================================
#          INVOICE ITEMS
# ================================
type InvoiceItem {
  id: ID!
  description: String!
  quantity: Int!
  unitPrice: Float!
  total: Float!
  invoice: Invoice!
}

# ================================
#          INPUT TYPES
# ================================
input CreateInvoiceItemInput {
  description: String!
  quantity: Int = 1
  unitPrice: Float!
}

input CreateInvoiceInput {
  projectId: ID!
  clientId: ID!           # NEW
  clientAddressId: ID     # OPTIONAL â€” job/site

  notes: String
  issueDate: DateTime
  dueDate: DateTime

  # Totals
  items: [CreateInvoiceItemInput!]!
  taxRate: Float = 0.1
  subtotal: Float!
  taxAmount: Float!
  totalAmount: Float!
}

input UpdateInvoiceInput {
  invoiceNumber: String
  issueDate: DateTime
  dueDate: DateTime
  status: InvoiceStatus
  notes: String
  taxRate: Float

  items: [CreateInvoiceItemInput!]

  # Allow editing JSON snapshots if needed:
  businessSnapshot: JSON
  clientSnapshot: JSON
}

# ================================
#         OPERATIONS
# ================================
extend type Query {
  invoice(id: ID!): Invoice
  invoices(projectId: ID): [Invoice!]!
}

extend type Mutation {
  createInvoice(input: CreateInvoiceInput!): Invoice!
  updateInvoice(id: ID!, input: UpdateInvoiceInput!): Invoice!
  deleteInvoice(id: ID!): Invoice!
  createInvoiceFromQuote(quoteId: ID!): Invoice!
}
