# --- Invoice Type Definitions ---

type Invoice {
  id: ID!
  invoiceNumber: String!
  status: InvoiceStatus!
  issueDate: DateTime!
  dueDate: DateTime!
  subtotal: Float!
  gstRate: Float!
  gstAmount: Float!
  totalAmount: Float!
  createdAt: DateTime!
  updatedAt: DateTime!
  project: Project!
  items: [InvoiceItem!]!
  payments: [Payment!]!
  notes: String

  # Snapshot Fields (NEW)
  businessName: String
  abn: String
  address: String
  phone: String
  email: String
  website: String
  logoUrl: String
  bankDetails: String
}

type InvoiceItem {
  id: ID!
  description: String!
  quantity: Int!
  unitPrice: Float!
  total: Float!
  invoice: Invoice!
}

# --- Input Types ---

input CreateInvoiceItemInput {
  description: String!
  quantity: Int = 1
  unitPrice: Float!
}

input CreateInvoiceInput {
  projectId: ID!
  invoiceNumber: String!
  dueDate: DateTime!
  issueDate: DateTime!
  notes: String
  status: InvoiceStatus = DRAFT
  items: [CreateInvoiceItemInput!]!
  gstRate: Float = 0.1

  # Snapshot Fields (NEW)
  businessName: String
  abn: String
  address: String
  phone: String
  email: String
  website: String
  logoUrl: String
  bankDetails: String
}

input UpdateInvoiceInput {
  invoiceNumber: String
  issueDate: DateTime
  dueDate: DateTime
  status: InvoiceStatus
  notes: String
  subtotal: Float
  gstRate: Float
  gstAmount: Float
  totalAmount: Float

  # Full item list replaces existing ones
  items: [CreateInvoiceItemInput!]

  # Snapshot fields
  businessName: String
  abn: String
  address: String
  phone: String
  email: String
  website: String
  logoUrl: String
  bankDetails: String
}

# --- API Operations ---

extend type Query {
  invoice(id: ID!): Invoice
  invoices(projectId: ID): [Invoice!]!
}

extend type Mutation {
  createInvoice(input: CreateInvoiceInput!): Invoice!
  updateInvoice(id: ID!, input: UpdateInvoiceInput!): Invoice!
  deleteInvoice(id: ID!): Invoice!
  createInvoiceFromQuote(quoteId: ID!): Invoice!
}
